<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cool Data Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Interactive Data Dashboard</h1>
        
        <div class="controls">
            <button onclick="updateData()">ðŸŽ² Generate New Data</button>
            <button onclick="animateChart()">âœ¨ Animate</button>
            <button onclick="toggleTheme()">ðŸŽ¨ Toggle Theme</button>
        </div>

        <div class="chart-container">
            <div class="chart">
                <h3>ðŸ“Š Sales Performance</h3>
                <div id="barChart"></div>
            </div>
            
            <div class="chart">
                <h3>ðŸ¥§ Market Share</h3>
                <div id="pieChart"></div>
            </div>
        </div>

        <div class="chart">
            <h3>ðŸ“ˆ Trend Analysis</h3>
            <div id="lineChart"></div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Sample data
        let salesData = [
            {product: 'Product A', sales: 120, color: '#ff6b6b'},
            {product: 'Product B', sales: 150, color: '#4ecdc4'},
            {product: 'Product C', sales: 80, color: '#45b7d1'},
            {product: 'Product D', sales: 200, color: '#96ceb4'},
            {product: 'Product E', sales: 90, color: '#feca57'}
        ];

        let trendData = [
            {month: 'Jan', value: 100},
            {month: 'Feb', value: 130},
            {month: 'Mar', value: 110},
            {month: 'Apr', value: 160},
            {month: 'May', value: 140},
            {month: 'Jun', value: 180},
            {month: 'Jul', value: 200},
            {month: 'Aug', value: 175},
            {month: 'Sep', value: 210},
            {month: 'Oct', value: 190},
            {month: 'Nov', value: 230},
            {month: 'Dec', value: 250}
        ];

        // Tooltip
        const tooltip = d3.select('#tooltip');

        // Create Bar Chart
        function createBarChart() {
            const margin = {top: 20, right: 30, bottom: 40, left: 40};
            const width = 400 - margin.left - margin.right;
            const height = 300 - margin.bottom - margin.top;

            d3.select('#barChart').selectAll('*').remove();

            const svg = d3.select('#barChart')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .range([0, width])
                .domain(salesData.map(d => d.product))
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(salesData, d => d.sales)])
                .range([height, 0]);

            svg.selectAll('.bar')
                .data(salesData)
                .enter().append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.product))
                .attr('width', x.bandwidth())
                .attr('y', height)
                .attr('height', 0)
                .attr('fill', d => d.color)
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`${d.product}<br/>Sales: ${d.sales}`)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function(d) {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                })
                .transition()
                .duration(1000)
                .delay((d, i) => i * 100)
                .attr('y', d => y(d.sales))
                .attr('height', d => height - y(d.sales));

            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));
        }

        // Create Pie Chart
        function createPieChart() {
            const width = 300;
            const height = 300;
            const radius = Math.min(width, height) / 2 - 10;

            d3.select('#pieChart').selectAll('*').remove();

            const svg = d3.select('#pieChart')
                .append('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', `translate(${width/2},${height/2})`);

            const color = d3.scaleOrdinal()
                .domain(salesData.map(d => d.product))
                .range(salesData.map(d => d.color));

            const pie = d3.pie()
                .value(d => d.sales);

            const arc = d3.arc()
                .innerRadius(40)
                .outerRadius(radius);

            const arcs = svg.selectAll('.arc')
                .data(pie(salesData))
                .enter().append('g')
                .attr('class', 'arc');

            arcs.append('path')
                .attr('d', arc)
                .attr('fill', d => d.data.color)
                .style('opacity', 0)
                .on('mouseover', function(event, d) {
                    d3.select(this).transition()
                        .duration(200)
                        .style('opacity', 0.7);
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`${d.data.product}<br/>Sales: ${d.data.sales}<br/>Share: ${(d.data.sales/d3.sum(salesData, d => d.sales)*100).toFixed(1)}%`)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function(d) {
                    d3.select(this).transition()
                        .duration(200)
                        .style('opacity', 1);
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                })
                .transition()
                .duration(1000)
                .delay((d, i) => i * 100)
                .style('opacity', 1);
        }

        // Create Line Chart
        function createLineChart() {
            const margin = {top: 20, right: 30, bottom: 40, left: 40};
            const width = 800 - margin.left - margin.right;
            const height = 300 - margin.top - margin.bottom;

            d3.select('#lineChart').selectAll('*').remove();

            const svg = d3.select('#lineChart')
                .append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const x = d3.scalePoint()
                .domain(trendData.map(d => d.month))
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(trendData, d => d.value)])
                .range([height, 0]);

            const line = d3.line()
                .x(d => x(d.month))
                .y(d => y(d.value))
                .curve(d3.curveMonotoneX);

            // Add gradient
            const gradient = svg.append('defs')
                .append('linearGradient')
                .attr('id', 'gradient')
                .attr('gradientUnits', 'userSpaceOnUse')
                .attr('x1', 0).attr('y1', height)
                .attr('x2', 0).attr('y2', 0);

            gradient.append('stop')
                .attr('offset', '0%')
                .attr('stop-color', '#667eea')
                .attr('stop-opacity', 0.1);

            gradient.append('stop')
                .attr('offset', '100%')
                .attr('stop-color', '#667eea')
                .attr('stop-opacity', 0.8);

            // Add area
            const area = d3.area()
                .x(d => x(d.month))
                .y0(height)
                .y1(d => y(d.value))
                .curve(d3.curveMonotoneX);

            svg.append('path')
                .datum(trendData)
                .attr('fill', 'url(#gradient)')
                .attr('d', area)
                .style('opacity', 0)
                .transition()
                .duration(1500)
                .style('opacity', 1);

            // Add line
            const path = svg.append('path')
                .datum(trendData)
                .attr('fill', 'none')
                .attr('stroke', '#667eea')
                .attr('stroke-width', 3)
                .attr('d', line);

            const totalLength = path.node().getTotalLength();

            path
                .attr('stroke-dasharray', totalLength + ' ' + totalLength)
                .attr('stroke-dashoffset', totalLength)
                .transition()
                .duration(2000)
                .ease(d3.easeLinear)
                .attr('stroke-dashoffset', 0);

            // Add dots
            svg.selectAll('.dot')
                .data(trendData)
                .enter().append('circle')
                .attr('class', 'dot')
                .attr('cx', d => x(d.month))
                .attr('cy', d => y(d.value))
                .attr('r', 0)
                .attr('fill', '#667eea')
                .attr('stroke', 'white')
                .attr('stroke-width', 2)
                .on('mouseover', function(event, d) {
                    d3.select(this).transition()
                        .duration(200)
                        .attr('r', 8);
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`${d.month}<br/>Value: ${d.value}`)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function(d) {
                    d3.select(this).transition()
                        .duration(200)
                        .attr('r', 5);
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                })
                .transition()
                .duration(1000)
                .delay((d, i) => i * 100 + 1000)
                .attr('r', 5);

            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));
        }

        // Update data function
        function updateData() {
            salesData = salesData.map(d => ({
                ...d,
                sales: Math.floor(Math.random() * 200) + 50
            }));
            
            trendData = trendData.map(d => ({
                ...d,
                value: Math.floor(Math.random() * 200) + 100
            }));

            createBarChart();
            createPieChart();
            createLineChart();
        }

        // Animate function
        function animateChart() {
            d3.selectAll('.bar')
                .transition()
                .duration(1000)
                .attr('transform', 'scale(1.1)')
                .transition()
                .duration(1000)
                .attr('transform', 'scale(1)');
        }

        // Toggle theme function
        let darkTheme = false;
        function toggleTheme() {
            darkTheme = !darkTheme;
            const container = document.querySelector('.container');
            if (darkTheme) {
                container.style.background = 'rgba(30, 30, 30, 0.95)';
                container.style.color = 'white';
            } else {
                container.style.background = 'rgba(255, 255, 255, 0.95)';
                container.style.color = 'black';
            }
        }

        // Initialize charts
        createBarChart();
        createPieChart();
        createLineChart();
    </script>
</body>
</html>